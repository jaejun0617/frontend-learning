/****
 * =====================================================================
 * async / await - í•™ìŠµ+ì‹¤ë¬´ í…œí”Œë¦¿ (2026)
 * =====================================================================
 * â­ = ì‹¤ë¬´ ë¹ˆì¶œ / ğŸ”¥ = ë©´ì ‘ í•µì‹¬ / ğŸ›¡ï¸ = ì‹¤ìˆ˜ ë°©ì§€
 *
 * [ë§¨ ìœ„ ê²°ë¡ : ì§„ì§œ ì¤‘ìš” vs ê°œë…ë§Œ âœ…]
 * âœ… ì§„ì§œ ì¤‘ìš” â­ğŸ”¥
 * - async/awaitëŠ” Promise ìœ„ì— ì–¹íŒ "ë¬¸ë²• ì„¤íƒ•"ì´ë‹¤.
 * - awaitëŠ” "Promiseê°€ ëë‚  ë•Œê¹Œì§€" í•´ë‹¹ async í•¨ìˆ˜ì˜ ë‹¤ìŒ ì¤„ì„ ì ê¹ ë©ˆì¶˜ë‹¤.
 * - ì—ëŸ¬ ì²˜ë¦¬ëŠ” try/catchë¡œ ì½ê¸° ì‰¬ì›Œì ¸ì„œ ì‹¤ë¬´ ìµœì„ í˜¸.
 *
 * [í•µì‹¬ì •ë¦¬(ë¨¼ì € ì½ê¸°) ğŸ”¥]
 * 1) async í•¨ìˆ˜ëŠ” í•­ìƒ Promiseë¥¼ ë°˜í™˜í•œë‹¤.
 * 2) awaitëŠ” Promise ê²°ê³¼ë¥¼ "ê°’"ì²˜ëŸ¼ ë°›ê²Œ í•´ì¤€ë‹¤.
 * 3) ë³‘ë ¬ì€ awaitë¥¼ ì—°ì†ìœ¼ë¡œ í•˜ì§€ ë§ê³  Promise.allë¡œ ë¬¶ì. â­ğŸ”¥
 */

console.clear?.();

const line = (n = 92) => '='.repeat(n);
const section = (title) => {
   console.log(`\n${line()}`);
   console.log(`â–¶ ${title}`);
   console.log(line());
};

// ---------------------------------------------------------------------
// [ë„êµ¬] ë¹„ë™ê¸° ì‘ì—… í‰ë‚´
// ---------------------------------------------------------------------
const delay = (ms) => new Promise((resolve) => setTimeout(resolve, ms));

async function fakeFetch(name, ms, shouldFail = false) {
   await delay(ms);
   if (shouldFail) throw new Error(`${name} ì‹¤íŒ¨(ì˜ë„ëœ ì—ëŸ¬)`);
   return `${name} ë°ì´í„°`;
}

// =====================================================================
// 1) [ì´ˆê¸‰] asyncëŠ” Promiseë¥¼ ë°˜í™˜í•œë‹¤
// =====================================================================
{
   section('1. [ì´ˆê¸‰] async í•¨ìˆ˜ì˜ ë°˜í™˜ê°’ì€ Promise');

   async function getHello() {
      return 'hello';
   }

   const result = getHello();
   console.log('getHello() =', result); // Promise

   result.then((v) => console.log('resolved value:', v));
}

// =====================================================================
// 2) [ì¤‘ê¸‰] awaitë¡œ "ê°’ì²˜ëŸ¼" ë°›ëŠ”ë‹¤ (try/catch) â­
// =====================================================================
{
   section('2. [ì¤‘ê¸‰] await + try/catch (ê°€ë…ì„± ìµœê°• â­)');

   async function run() {
      try {
         const data = await fakeFetch('user', 120);
         console.log('data:', data);
      } catch (e) {
         console.error('ì—ëŸ¬:', e.message);
      }
   }

   run();
}

// =====================================================================
// 3) [ê³ ê¸‰] awaitë¥¼ ì—°ì†ìœ¼ë¡œ í•˜ë©´ "ì§ë ¬"ì´ ëœë‹¤(ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ) ğŸ”¥
// =====================================================================
{
   section('3. [ê³ ê¸‰] ì§ë ¬ vs ë³‘ë ¬: Promise.allì„ ì¨ë¼ ğŸ”¥');

   async function serial() {
      const a = await fakeFetch('A', 120);
      const b = await fakeFetch('B', 120);
      return [a, b];
   }

   async function parallel() {
      const [a, b] = await Promise.all([
         fakeFetch('A', 120),
         fakeFetch('B', 120),
      ]);
      return [a, b];
   }

   serial().then((v) => console.log('serial:', v));
   parallel().then((v) => console.log('parallel:', v));

   /**
    * ì™œ ì¤‘ìš”í•œê°€?
    * - awaitë¥¼ ìˆœì„œëŒ€ë¡œ ì“°ë©´ ì´ì „ ì‘ì—…ì´ ëë‚  ë•Œê¹Œì§€ ë‹¤ìŒ ì‘ì—…ì„ ì‹œì‘ ëª» í•¨(ì§ë ¬)
    * - ì„œë¡œ ë…ë¦½ì´ë©´ Promise.allë¡œ ë³‘ë ¬ ì²˜ë¦¬í•´ì•¼ ë¹ ë¥´ë‹¤ â­
    */
}

// =====================================================================
// 4) [ì‹¤ë¬´íŒ¨í„´] â­ ì—ëŸ¬ë¥¼ í•œ ê³³ì—ì„œ ì²˜ë¦¬í•˜ê³ , ë°˜í™˜ íƒ€ì…ì„ í†µì¼í•˜ì
// =====================================================================
{
   section('4. [ì‹¤ë¬´íŒ¨í„´] ì•ˆì „í•œ async í•¨ìˆ˜ íŒ¨í„´(ğŸ›¡ï¸)');

   /**
    * ì‹¤ë¬´ íŒ:
    * - í•¨ìˆ˜ê°€ ë˜ì§€ëŠ” ì—ëŸ¬ë¥¼ "ìƒìœ„ ë ˆì´ì–´"ì—ì„œ ì¼ê´€ë˜ê²Œ ì²˜ë¦¬
    * - ë˜ëŠ” Result íƒ€ì…ì²˜ëŸ¼ {ok, data, error}ë¡œ í†µì¼
    */

   async function safeFetch() {
      try {
         const data = await fakeFetch('profile', 80, false);
         return { ok: true, data, error: null };
      } catch (e) {
         return { ok: false, data: null, error: e.message };
      }
   }

   safeFetch().then((r) => console.log('safeFetch:', r));
}

// =====================================================================
// 5) [í•µì‹¬ì •ë¦¬] ë³µìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸ 12ê°œ âœ…
// =====================================================================
{
   section('5. [í•µì‹¬ì •ë¦¬] ë³µìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸ 12ê°œ âœ…');

   const checklist = [
      'async í•¨ìˆ˜ëŠ” í•­ìƒ Promiseë¥¼ ë°˜í™˜í•œë‹¤. ğŸ”¥',
      'awaitëŠ” Promise ê²°ê³¼ë¥¼ ê°’ì²˜ëŸ¼ ë°›ê²Œ í•´ì¤€ë‹¤. â­',
      'awaitëŠ” í•´ë‹¹ async í•¨ìˆ˜ ë‚´ë¶€ì˜ ë‹¤ìŒ ì¤„ì„ ì ê¹ ë©ˆì¶˜ë‹¤. ğŸ”¥',
      'try/catchëŠ” async/awaitì—ì„œ ê°€ì¥ ì½ê¸° ì‰¬ìš´ ì—ëŸ¬ ì²˜ë¦¬ë‹¤. â­',
      'ì—ëŸ¬ëŠ” í•œ ê³³ì—ì„œ ì¼ê´€ë˜ê²Œ ì²˜ë¦¬í•´ì•¼ ìœ ì§€ë³´ìˆ˜ê°€ ì‰½ë‹¤. ğŸ›¡ï¸',
      'awaitë¥¼ ì—°ì†ìœ¼ë¡œ ì“°ë©´ ì§ë ¬ ì‹¤í–‰ì´ ëœë‹¤(ëŠë ¤ì§ˆ ìˆ˜ ìˆìŒ). ğŸ”¥',
      'ë…ë¦½ ì‘ì—…ì€ Promise.allë¡œ ë³‘ë ¬ ì²˜ë¦¬í•˜ì. â­ğŸ”¥',
      'Promise.allì€ í•˜ë‚˜ ì‹¤íŒ¨í•˜ë©´ ì „ì²´ ì‹¤íŒ¨í•œë‹¤. â­',
      'ë¶€ë¶„ ì„±ê³µì´ í•„ìš”í•˜ë©´ allSettledë¥¼ ê³ ë ¤í•œë‹¤. â­',
      'finallyëŠ” ì •ë¦¬/ë¦¬ì†ŒìŠ¤ í•´ì œì— ì‚¬ìš©í•œë‹¤. â­',
      'ì‹¤ë¬´ì—ì„œëŠ” ë°˜í™˜ íƒ€ì…(Result)ì„ í†µì¼í•˜ë©´ ì˜ˆì¸¡ ê°€ëŠ¥ì„±ì´ ë†’ë‹¤. ğŸ›¡ï¸',
      'ë©´ì ‘ì—ì„œëŠ” "async/awaitëŠ” Promise ê¸°ë°˜"ì´ë¼ê³  ë§í•˜ë©´ ëœë‹¤. ğŸ”¥',
   ];

   checklist.forEach((item, idx) => {
      console.log(`${String(idx + 1).padStart(2, '0')}. ${item}`);
   });
}

console.log(`\n${line()}`);
console.log('async/await í…œí”Œë¦¿ ë! âœ…');
console.log(line());
