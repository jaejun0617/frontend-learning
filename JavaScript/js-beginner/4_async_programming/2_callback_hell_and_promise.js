/***************************************************************
 * =====================================================================
 * Callback Hell & Promise - í•™ìŠµ+ì‹¤ë¬´ í…œí”Œë¦¿ (2026)
 * =====================================================================
 * â­ = ì‹¤ë¬´ ë¹ˆì¶œ / ğŸ”¥ = ë©´ì ‘ í•µì‹¬ / ğŸ›¡ï¸ = ì‹¤ìˆ˜ ë°©ì§€
 *
 * [ë§¨ ìœ„ ê²°ë¡ : ì§„ì§œ ì¤‘ìš” vs ê°œë…ë§Œ âœ…]
 * âœ… ì§„ì§œ ì¤‘ìš” â­ğŸ”¥
 * - ì½œë°± ì§€ì˜¥ì€ "ì¤‘ì²©"ë³´ë‹¤ "ì—ëŸ¬/íë¦„ ê´€ë¦¬"ê°€ ì–´ë ¤ì›Œì„œ ìƒê¸´ë‹¤.
 * - PromiseëŠ” ì„±ê³µ(resolve) / ì‹¤íŒ¨(reject) íë¦„ì„ í‘œì¤€í™”í•˜ê³  ì²´ì´ë‹ì„ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.
 * - ì‹¤ë¬´ì—ì„œëŠ” Promise + async/awaitë¡œ ì½ê¸° ì‰½ê²Œ ë§Œë“ ë‹¤.
 *
 * [í•µì‹¬ì •ë¦¬(ë¨¼ì € ì½ê¸°) ğŸ”¥]
 * 1) ì½œë°± ìŠ¤íƒ€ì¼: (err, data) íŒ¨í„´ì´ í”í•¨(Node ìŠ¤íƒ€ì¼)
 * 2) PromiseëŠ” ìƒíƒœ 3ê°€ì§€: pending â†’ fulfilled / rejected
 * 3) thenì€ ì„±ê³µ, catchëŠ” ì‹¤íŒ¨, finallyëŠ” ì •ë¦¬
 */

console.clear?.();

const line = (n = 90) => '='.repeat(n);
const section = (title) => {
   console.log(`\n${line()}`);
   console.log(`â–¶ ${title}`);
   console.log(line());
};

// ---------------------------------------------------------------------
// [ë„êµ¬] ë¹„ë™ê¸° ì‘ì—… í‰ë‚´: callback ë²„ì „ & promise ë²„ì „
// ---------------------------------------------------------------------
function fakeRequestCb(name, ms, cb) {
   setTimeout(() => {
      // ğŸ›¡ï¸ í•™ìŠµìš©: íŠ¹ì • ì…ë ¥ì´ë©´ ì‹¤íŒ¨
      if (name === 'step2')
         return cb(new Error('step2 ì‹¤íŒ¨(ì˜ë„ëœ ì—ëŸ¬)'), null);
      cb(null, `[${name}] ì™„ë£Œ`);
   }, ms);
}

function fakeRequest(name, ms) {
   return new Promise((resolve, reject) => {
      setTimeout(() => {
         if (name === 'step2')
            return reject(new Error('step2 ì‹¤íŒ¨(ì˜ë„ëœ ì—ëŸ¬)'));
         resolve(`[${name}] ì™„ë£Œ`);
      }, ms);
   });
}

// =====================================================================
// 1) [ì´ˆê¸‰] ì½œë°± íŒ¨í„´: ì™œ ë¶ˆí¸í•´ì§€ë‚˜?
// =====================================================================
{
   section('1. [ì´ˆê¸‰] ì½œë°± ê¸°ë³¸: (err, data)');

   fakeRequestCb('step1', 100, (err, data) => {
      if (err) return console.error('step1 err:', err.message);
      console.log(data);
   });

   /**
    * ì—¬ê¸°ê¹Œì§„ ê´œì°®ë‹¤.
    * ë¬¸ì œëŠ” "ìˆœì„œ ì˜ì¡´"ì´ ìƒê¸°ë©´ ì¤‘ì²©ì´ ì‹œì‘ëœë‹¤.
    */
}

// =====================================================================
// 2) [ì¤‘ê¸‰] ì½œë°± ì§€ì˜¥: ì¤‘ì²© + ì—ëŸ¬ ë¶„ê¸° + ìœ ì§€ë³´ìˆ˜ ì•…ëª½
// =====================================================================
{
   section('2. [ì¤‘ê¸‰] Callback Hellì´ ìƒê¸°ëŠ” ì´ìœ (ì¤‘ì²©+ì—ëŸ¬) ğŸ”¥');

   fakeRequestCb('step1', 100, (err1, data1) => {
      if (err1) return console.error('step1 err:', err1.message);
      console.log(data1);

      fakeRequestCb('step2', 100, (err2, data2) => {
         if (err2) return console.error('step2 err:', err2.message);
         console.log(data2);

         fakeRequestCb('step3', 100, (err3, data3) => {
            if (err3) return console.error('step3 err:', err3.message);
            console.log(data3);
            console.log('ëª¨ë“  ë‹¨ê³„ ì™„ë£Œ');
         });
      });
   });

   /**
    * "ì™œ" í˜ë“¤ì–´ì§€ë‚˜?
    * - ë“¤ì—¬ì“°ê¸° ì¦ê°€(ê°€ë…ì„±â†“)
    * - ì¤‘ê°„ ì—ëŸ¬ ì²˜ë¦¬ ë¡œì§ì´ ë°˜ë³µ
    * - ë‹¨ê³„ ì¶”ê°€/ìˆœì„œ ë³€ê²½ì´ ë§¤ìš° ì–´ë ¤ì›€
    */
}

// =====================================================================
// 3) [ê³ ê¸‰] Promise ì²´ì´ë‹: íë¦„ì„ "í•œ ì¤„"ë¡œ ë§Œë“ ë‹¤ ğŸ”¥
// =====================================================================
{
   section('3. [ê³ ê¸‰] Promise ì²´ì´ë‹: then/catch/finally ğŸ”¥');

   fakeRequest('step1', 100)
      .then((msg1) => {
         console.log(msg1);
         return fakeRequest('step2', 100);
      })
      .then((msg2) => {
         console.log(msg2);
         return fakeRequest('step3', 100);
      })
      .then((msg3) => {
         console.log(msg3);
         console.log('ëª¨ë“  ë‹¨ê³„ ì™„ë£Œ');
      })
      .catch((e) => {
         // â­ ì—ëŸ¬ ì²˜ë¦¬ ì§€ì ì„ 1êµ°ë°ë¡œ ëª¨ì„ ìˆ˜ ìˆìŒ
         console.error('ì‹¤íŒ¨:', e.message);
      })
      .finally(() => {
         console.log('ì •ë¦¬(finally)');
      });
}

// =====================================================================
// 4) [ì‹¤ë¬´íŒ¨í„´] â­ Promise.all / allSettled / race (ë³‘ë ¬ ì²˜ë¦¬)
// =====================================================================
{
   section('4. [ì‹¤ë¬´íŒ¨í„´] ë³‘ë ¬ ì²˜ë¦¬: Promise.all / allSettled â­');

   // âœ… all: í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ ì „ì²´ reject
   Promise.all([
      fakeRequest('p1', 80),
      fakeRequest('p2', 120),
      fakeRequest('p3', 60),
   ])
      .then((results) => console.log('all results:', results))
      .catch((e) => console.error('all failed:', e.message));

   // âœ… allSettled: ì„±ê³µ/ì‹¤íŒ¨ë¥¼ ëª¨ë‘ ê²°ê³¼ë¡œ ë°›ìŒ(ì‹¤ë¬´ì—ì„œ ë¡œê·¸ ìˆ˜ì§‘/ë¶€ë¶„ ì„±ê³µì— ìœ ë¦¬)
   Promise.allSettled([
      fakeRequest('p4', 80),
      fakeRequest('step2', 50),
      fakeRequest('p6', 60),
   ]).then((results) =>
      console.log(
         'allSettled:',
         results.map((r) => r.status),
      ),
   );
}

// =====================================================================
// 5) [í•µì‹¬ì •ë¦¬] ë³µìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸ 12ê°œ âœ…
// =====================================================================
{
   section('5. [í•µì‹¬ì •ë¦¬] ë³µìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸ 12ê°œ âœ…');

   const checklist = [
      'ì½œë°± ì§€ì˜¥ì˜ ë³¸ì§ˆì€ "ì—ëŸ¬/íë¦„ ê´€ë¦¬"ê°€ ì–´ë ¤ìš´ ê²ƒì´ë‹¤. ğŸ”¥',
      'ì½œë°± íŒ¨í„´ì€ (err, data) ìŠ¤íƒ€ì¼ì´ í”í•˜ë‹¤. â­',
      'PromiseëŠ” pending â†’ fulfilled/rejected ìƒíƒœë¥¼ ê°€ì§„ë‹¤. ğŸ”¥',
      'thenì€ ì„±ê³µ, catchëŠ” ì‹¤íŒ¨, finallyëŠ” ì •ë¦¬ë‹¤. â­',
      'Promise ì²´ì´ë‹ì€ returnìœ¼ë¡œ ë‹¤ìŒ ë¹„ë™ê¸°ë¥¼ ì—°ê²°í•œë‹¤. ğŸ”¥',
      'catchëŠ” ì—¬ëŸ¬ ë‹¨ê³„ì˜ ì—ëŸ¬ë¥¼ í•œ ê³³ì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤. â­',
      'allì€ í•˜ë‚˜ ì‹¤íŒ¨í•˜ë©´ ì „ì²´ ì‹¤íŒ¨(reject). â­',
      'allSettledëŠ” ì„±ê³µ/ì‹¤íŒ¨ë¥¼ ëª¨ë‘ ìˆ˜ì§‘í•  ìˆ˜ ìˆë‹¤. â­',
      'raceëŠ” ê°€ì¥ ë¨¼ì € ëë‚œ ê²°ê³¼ë¥¼ ì‚¬ìš©í•œë‹¤(ê²½í•©). ğŸ”¥',
      'ì‹¤ë¬´ì—ì„œëŠ” Promiseë¥¼ async/awaitë¡œ ê°ì‹¸ ì½ê¸° ì‰½ê²Œ ë§Œë“ ë‹¤. â­',
      'ì—ëŸ¬ ì²˜ë¦¬ ì§€ì (ë¡œê·¸/ë¦¬í¬íŒ…)ì„ ì¼ê´€ë˜ê²Œ ìœ ì§€í•˜ì. ğŸ›¡ï¸',
      'ë©´ì ‘ì—ì„œëŠ” "ì™œ Promiseê°€ ì¢‹ì€ê°€"ë¥¼ íë¦„/ì—ëŸ¬ í‘œì¤€í™”ë¡œ ë§í•˜ë©´ ëœë‹¤. ğŸ”¥',
   ];

   checklist.forEach((item, idx) => {
      console.log(`${String(idx + 1).padStart(2, '0')}. ${item}`);
   });
}

console.log(`\n${line()}`);
console.log('Callback Hell & Promise í…œí”Œë¦¿ ë! âœ…');
console.log(line());
