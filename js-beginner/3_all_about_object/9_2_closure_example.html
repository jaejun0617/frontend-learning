<!doctype html>
<html lang="ko">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>9_2 Closure Example - Counter Demo</title>
      <style>
         body {
            font-family:
               system-ui,
               -apple-system,
               Segoe UI,
               Roboto,
               Helvetica,
               Arial,
               sans-serif;
            padding: 24px;
            line-height: 1.6;
         }
         .wrap {
            max-width: 720px;
            margin: 0 auto;
         }
         .card {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
         }
         button {
            padding: 10px 14px;
            border-radius: 10px;
            border: 1px solid #d1d5db;
            background: white;
            cursor: pointer;
         }
         button:active {
            transform: translateY(1px);
         }
         code {
            background: #f5f5f5;
            padding: 2px 6px;
            border-radius: 6px;
         }
         .row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
         }
         .big {
            font-size: 22px;
            font-weight: 700;
         }
         .hint {
            opacity: 0.8;
         }
         ul {
            margin: 8px 0 0;
            padding-left: 18px;
         }
      </style>
   </head>
   <body>
      <div class="wrap">
         <h1>Closure Demo (ìƒíƒœë¥¼ ê¸°ì–µí•˜ëŠ” í•¨ìˆ˜)</h1>
         <p class="hint">
            ë²„íŠ¼ì„ ëˆŒëŸ¬ë„ <code>count</code>ê°€ ìœ ì§€ë˜ëŠ” ì´ìœ ê°€ "í´ë¡œì €"ì…ë‹ˆë‹¤.
            ì½˜ì†”ë„ ê°™ì´ í™•ì¸í•˜ì„¸ìš”.
         </p>

         <div class="card" data-counter="A">
            <div class="row">
               <span class="big" id="countA" data-role="count">A: 0</span>
               <button id="incA" data-role="inc">A +1</button>
               <button id="resetA" data-role="reset">A reset</button>
            </div>
            <p class="hint">AëŠ” Aë§Œì˜ í´ë¡œì € ìƒíƒœë¥¼ ê°€ì§‘ë‹ˆë‹¤.</p>
         </div>

         <div class="card" data-counter="B">
            <div class="row">
               <span class="big" id="countB" data-role="count">B: 0</span>
               <button id="incB" data-role="inc">B +1</button>
               <button id="resetB" data-role="reset">B reset</button>
            </div>
            <p class="hint">BëŠ” Bë§Œì˜ í´ë¡œì € ìƒíƒœë¥¼ ê°€ì§‘ë‹ˆë‹¤(Aì™€ ë…ë¦½).</p>
         </div>

         <div class="card" data-counter="C">
            <div class="row">
               <span class="big" id="countC" data-role="count">C: 0</span>
               <button id="incC" data-role="inc">C +1</button>
               <button id="resetC" data-role="reset">C reset</button>
            </div>
            <p class="hint">CëŠ” Cë§Œì˜ í´ë¡œì € ìƒíƒœë¥¼ ê°€ì§‘ë‹ˆë‹¤(A/Bì™€ ë…ë¦½).</p>
         </div>

         <div class="card">
            <h2>ì»¨íŠ¸ë¡¤</h2>
            <div class="row">
               <button id="resetAll">ëª¨ë‘ reset</button>
               <button id="logToggle">ë¡œê·¸ ON</button>
            </div>
            <p class="hint">
               ì‹¤ë¬´ì—ì„  ë””ë²„ê·¸ ë¡œê·¸ë¥¼ í† ê¸€í•˜ëŠ” ìŠµê´€ì´ ë„ì›€ì´ ë©ë‹ˆë‹¤.
            </p>
         </div>

         <div class="card">
            <h2>í•µì‹¬ í¬ì¸íŠ¸</h2>
            <ul>
               <li>
                  <b>í´ë¡œì €</b>ëŠ” í•¨ìˆ˜ê°€ ë°”ê¹¥ ë³€ìˆ˜ë¥¼ <b>ì°¸ì¡°</b>í•´ì„œ "ê¸°ì–µ"í•˜ëŠ”
                  í˜„ìƒ
               </li>
               <li>
                  í•¨ìˆ˜ë¥¼ ë°˜í™˜í•˜ë©´ ë°”ê¹¥ í•¨ìˆ˜ëŠ” ëë‚˜ë„, ë°˜í™˜ëœ í•¨ìˆ˜ê°€ ë³€ìˆ˜ ì°¸ì¡°ë¥¼
                  ìœ ì§€
               </li>
               <li>ê·¸ë˜ì„œ ì¹´ìš´í„°, ìƒíƒœ ì€ë‹‰, ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ì— ìì£¼ ì“°ì„ â­</li>
            </ul>
         </div>
      </div>

      <script>
         console.clear?.();

         /* ============================================================
          * Closure Demo - ìµœì¢… ì™„ì„±ë³¸(í•™ìŠµ+ì‹¤ë¬´) âœ…
          * ============================================================
          * ì´ íŒŒì¼ì˜ ëª©í‘œ:
          * 1) í´ë¡œì €ë¡œ "ìƒíƒœë¥¼ ê¸°ì–µ"í•˜ëŠ” counterë¥¼ ë§Œë“¤ê³ 
          * 2) DOMì—ì„œ ìë™ìœ¼ë¡œ ì¹´ìš´í„°ë¥¼ ìˆ˜ì§‘(A/B/C/D...)í•´ì„œ
          * 3) ë Œë”/ì´ë²¤íŠ¸ë¥¼ ê³µí†µ ë¡œì§ìœ¼ë¡œ ì²˜ë¦¬í•œë‹¤.
          *
          * â­ í¬ì¸íŠ¸
          * - createCounter() í˜¸ì¶œë§ˆë‹¤ ì„œë¡œ ë‹¤ë¥¸ private state(count)ê°€ ìƒê¹€(í´ë¡œì €)
          * - ì´ë²¤íŠ¸ëŠ” "ìœ„ì„"(delegation)ìœ¼ë¡œ 1ê°œ ë¦¬ìŠ¤ë„ˆë§Œ ì‚¬ìš©(í™•ì¥/ìœ ì§€ë³´ìˆ˜ ìœ ë¦¬)
          * - ë””ë²„ê·¸ ë¡œê·¸ëŠ” í† ê¸€ ê°€ëŠ¥í•˜ê²Œ(ì‹¤ë¬´ ìŠµê´€)
          */

         // ------------------------------------------------------------
         // ğŸ›¡ï¸ ë””ë²„ê·¸ ë¡œê·¸ í† ê¸€(ì‹¤ë¬´ì—ì„œ ì§„ì§œ ìœ ìš©)
         // ------------------------------------------------------------
         let DEBUG = true;
         const log = (...args) => {
            if (DEBUG) console.log(...args);
         };

         // ------------------------------------------------------------
         // 1) í´ë¡œì €ë¡œ ë§Œë“œëŠ” "ì¹´ìš´í„°"
         // ------------------------------------------------------------
         function createCounter(label) {
            let count = 0; // âœ… private state (í´ë¡œì €ê°€ ë¶™ì¡ê³  ìœ ì§€)

            const get = () => count;
            const set = (next) => {
               // ğŸ›¡ï¸ ìˆ«ìë§Œ í—ˆìš©(í•™ìŠµìš© ë°©ì–´)
               if (typeof next !== 'number' || Number.isNaN(next)) return;
               count = next;
            };
            const inc = () => (count += 1);
            const reset = () => (count = 0);

            log(`[${label}] counter created`);

            return { get, set, inc, reset };
         }

         // ------------------------------------------------------------
         // 2) DOMì—ì„œ ì¹´ìš´í„° ìë™ ìˆ˜ì§‘(í™•ì¥í˜•)
         // - HTMLì— data-counter="A"ë§Œ ì¶”ê°€í•˜ë©´ ìë™ìœ¼ë¡œ ë¶™ëŠ”ë‹¤.
         // ------------------------------------------------------------
         const $wrap = document.querySelector('.wrap');
         // â­ NodeList â†’ Array ë³€í™˜(ì‹¤ë¬´ì—ì„œ ê°€ì¥ í”í•œ íŒ¨í„´: ìŠ¤í”„ë ˆë“œ)
         const $cards = [...document.querySelectorAll('[data-counter]')];

         const COUNTERS = $cards
            .map(($card) => {
               const label = $card.dataset.counter;

               const $count = $card.querySelector('[data-role="count"]');
               const $inc = $card.querySelector('[data-role="inc"]');
               const $reset = $card.querySelector('[data-role="reset"]');

               // ğŸ›¡ï¸ í•„ìš”í•œ DOMì´ ë¹ ì¡Œìœ¼ë©´ ìŠ¤í‚µ(í•™ìŠµ ì¤‘ ì‹¤ìˆ˜í•´ë„ ì „ì²´ê°€ ì•ˆ ì£½ê²Œ)
               if (!label || !$count || !$inc || !$reset) {
                  console.warn('ì¹´ìš´í„° DOM êµ¬ì„± ëˆ„ë½:', { label, $card });
                  return null;
               }

               return {
                  label,
                  counter: createCounter(label),
                  $card,
                  $count,
               };
            })
            .filter(Boolean);

         // label -> item ë¹ ë¥´ê²Œ ì°¾ê¸°(ì´ë²¤íŠ¸ ìœ„ì„ì—ì„œ ìœ ìš©)
         const COUNTER_MAP = new Map(COUNTERS.map((it) => [it.label, it]));

         // ------------------------------------------------------------
         // 3) ë Œë”: ëª©ë¡ì„ ìˆœíšŒí•˜ë©° ìë™ ì¶œë ¥
         // ------------------------------------------------------------
         const render = () => {
            COUNTERS.forEach(({ label, counter, $count }) => {
               $count.textContent = `${label}: ${counter.get()}`;
            });
         };

         // ------------------------------------------------------------
         // 4) ì´ë²¤íŠ¸ ìœ„ì„(Delegation): ë¦¬ìŠ¤ë„ˆ 1ê°œë¡œ inc/reset ì²˜ë¦¬
         // ì™œ ì¢‹ë‚˜?
         // - ì¹´ìš´í„°ê°€ ëŠ˜ì–´ë‚˜ë„ ë¦¬ìŠ¤ë„ˆê°€ ëŠ˜ì§€ ì•ŠìŒ
         // - DOMì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë¼ë„(ì¶”í›„) ê°™ì€ ë¡œì§ìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥ â­
         // ------------------------------------------------------------
         $wrap.addEventListener('click', (e) => {
            const $btn = e.target.closest('button');
            if (!$btn) return;

            // ì»¨íŠ¸ë¡¤ ë²„íŠ¼ ì²˜ë¦¬
            if ($btn.id === 'resetAll') {
               log('resetAll');
               COUNTERS.forEach(({ counter }) => counter.reset());
               render();
               return;
            }

            if ($btn.id === 'logToggle') {
               DEBUG = !DEBUG;
               $btn.textContent = DEBUG ? 'ë¡œê·¸ ON' : 'ë¡œê·¸ OFF';
               console.log('DEBUG:', DEBUG);
               return;
            }

            // ì¹´ìš´í„° ë²„íŠ¼ ì²˜ë¦¬
            const $card = $btn.closest('[data-counter]');
            if (!$card) return;

            const label = $card.dataset.counter;
            const item = COUNTER_MAP.get(label);
            if (!item) return;

            const role = $btn.dataset.role;

            if (role === 'inc') {
               log(`${label} inc ->`, item.counter.inc());
               render();
               return;
            }

            if (role === 'reset') {
               log(`${label} reset`);
               item.counter.reset();
               render();
               return;
            }
         });

         // ì´ˆê¸° ë Œë”
         render();

         // ì´ˆê¸° ë²„íŠ¼ í…ìŠ¤íŠ¸ ë™ê¸°í™”
         const $logToggle = document.getElementById('logToggle');
         if ($logToggle)
            $logToggle.textContent = DEBUG ? 'ë¡œê·¸ ON' : 'ë¡œê·¸ OFF';
      </script>
   </body>
</html>
