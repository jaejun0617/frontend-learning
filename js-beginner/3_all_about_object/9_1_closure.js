/**
 * =====================================================================
 * Closure(í´ë¡œì €) - ë©´ì ‘/ì‹¤ë¬´ "ì§„ì§œ ì¤‘ìš”" ìµœì¢… í…œí”Œë¦¿ (2026)
 * =====================================================================
 * â­ = ì‹¤ë¬´ì—ì„œ ìì£¼ ì”€ / ğŸ”¥ = ë©´ì ‘ í•µì‹¬ / ğŸ›¡ï¸ = ì‹¤ìˆ˜ ë°©ì§€(Safety)
 *
 * [ë§¨ ìœ„ ê²°ë¡ : "ì§„ì§œ ì¤‘ìš”" vs "ê°œë…ë§Œ" âœ…]
 * âœ… ì§„ì§œ ì¤‘ìš”(ë¬´ì¡°ê±´ ì¡ê³  ê°€ì•¼ í•¨) â­ğŸ”¥
 * - í´ë¡œì € = "í•¨ìˆ˜" + "ê·¸ í•¨ìˆ˜ê°€ ì„ ì–¸ëœ ë ‰ì‹œì»¬ í™˜ê²½(ë°”ê¹¥ ë³€ìˆ˜ë“¤)"ì˜ ì¡°í•©
 * - ë°”ê¹¥ í•¨ìˆ˜ê°€ ëë‚¬ëŠ”ë°ë„, ì•ˆìª½ í•¨ìˆ˜ê°€ ë°”ê¹¥ ë³€ìˆ˜ë¥¼ ê³„ì† ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤
 * - ìƒíƒœ ì€ë‹‰(Private State), ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬, React Hooks, debounce/throttle, memoizeì— ê³„ì† ë“±ì¥
 *
 * â˜‘ï¸ ê°œë…ë§Œ ì´í•´í•˜ë©´ ì¶©ë¶„
 * - ë‚´ë¶€ ìš©ì–´(í™˜ê²½ ë ˆì½”ë“œ ë“±)ëŠ” ëª°ë¼ë„ ë¨: "ë³€ìˆ˜ë¥¼ ë³µì‚¬"í•˜ëŠ” ê²Œ ì•„ë‹ˆë¼ "ì°¸ì¡°"ë¥¼ ìœ ì§€í•œë‹¤ê°€ í•µì‹¬
 *
 * [í•µì‹¬ì •ë¦¬(ë¨¼ì € ì½ê¸°) ğŸ”¥]
 * 1) JSëŠ” ë ‰ì‹œì»¬ ìŠ¤ì½”í”„ë¼ì„œ í•¨ìˆ˜ê°€ "ì„ ì–¸ëœ ìœ„ì¹˜"ì˜ ë°”ê¹¥ ë³€ìˆ˜ë¥¼ ë³¸ë‹¤.
 * 2) í•¨ìˆ˜ê°€ ë°˜í™˜ë˜ì–´ë„, ê·¸ í•¨ìˆ˜ê°€ ì°¸ì¡°í•˜ëŠ” ë°”ê¹¥ ë³€ìˆ˜ëŠ” GCê°€ ëª» ì¹˜ìš´ë‹¤(ì•„ì§ ì“°ëŠ” ì¤‘).
 * 3) ê·¸ë˜ì„œ í´ë¡œì €ëŠ” "ìƒíƒœë¥¼ ê¸°ì–µ"í•  ìˆ˜ ìˆê³ , ë™ì‹œì— "ë©”ëª¨ë¦¬ ëˆ„ìˆ˜"ë„ ë§Œë“¤ ìˆ˜ ìˆë‹¤. ğŸ›¡ï¸
 */

console.clear?.();

// ---------------------------------------------------------------------
// [Utility] ì¶œë ¥ í¬ë§·íŒ…
// ---------------------------------------------------------------------
const line = (n = 92) => '='.repeat(n);
const section = (title) => {
   console.log(`\n${line()}`);
   console.log(`â–¶ ${title}`);
   console.log(line());
};

// =====================================================================
// 1) [ì´ˆê¸‰] í´ë¡œì €ê°€ "ì™œ" ìƒê¸°ë‚˜? (ë°”ê¹¥ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•˜ëŠ” í•¨ìˆ˜)
// =====================================================================
{
   section('1. [ì´ˆê¸‰] í´ë¡œì € ê¸°ë³¸: ë°”ê¹¥ ë³€ìˆ˜ë¥¼ ì°¸ì¡°í•˜ëŠ” í•¨ìˆ˜');

   /**
    * í•µì‹¬:
    * - í´ë¡œì €ëŠ” "íŠ¹ë³„í•œ ë¬¸ë²•"ì´ ì•„ë‹ˆë¼, "ìì—°ìŠ¤ëŸ½ê²Œ ìƒê¸°ëŠ” í˜„ìƒ"ì´ë‹¤.
    * - í•¨ìˆ˜ê°€ ë°”ê¹¥ ë³€ìˆ˜ë¥¼ ì“°ë©´, ê·¸ í•¨ìˆ˜ëŠ” ê·¸ ë³€ìˆ˜ë¥¼ ê³„ì† ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.
    */

   function outer() {
      const secret = 5;

      function inner() {
         // innerëŠ” secretì„ "ë³µì‚¬"í•œ ê²Œ ì•„ë‹ˆë¼, "ì°¸ì¡°"í•œë‹¤.
         return secret;
      }

      return inner;
   }

   const runner = outer();
   console.log('runner():', runner()); // 5
}

// =====================================================================
// 2) [ì¤‘ê¸‰] "ë°”ê¹¥ í•¨ìˆ˜ê°€ ëë‚¬ëŠ”ë°ë„" ì™œ ê°’ì´ ë‚¨ë‚˜? ğŸ”¥
// =====================================================================
{
   section('2. [ì¤‘ê¸‰] ë°”ê¹¥ í•¨ìˆ˜ ì¢…ë£Œ í›„ì—ë„ ê°’ì´ ë‚¨ëŠ” ì´ìœ (ğŸ”¥)');

   /**
    * ì™œ ì•ˆ ì‚¬ë¼ì§€ë‚˜?
    * - outerê°€ ëë‚˜ë„, inner(ë°˜í™˜ëœ í•¨ìˆ˜)ê°€ still ì°¸ì¡°í•˜ê³  ìˆìŒ
    * - ì°¸ì¡°ê°€ ë‚¨ì•„ìˆìœ¼ë©´ GC(ê°€ë¹„ì§€ ì»¬ë ‰í„°)ê°€ ì œê±°í•˜ì§€ ëª»í•œë‹¤.
    */

   function createCounter() {
      let count = 0; // private state

      return function inc() {
         count += 1;
         return count;
      };
   }

   const counterA = createCounter();
   const counterB = createCounter();

   console.log('A:', counterA()); // 1
   console.log('A:', counterA()); // 2
   console.log('B:', counterB()); // 1 (ì„œë¡œ ë…ë¦½)
}

// =====================================================================
// 3) [ê³ ê¸‰] ë©´ì ‘ ë‹¨ê³¨: for + var + ë¹„ë™ê¸°(ì½œë°±) ğŸ”¥
// =====================================================================
{
   section('3. [ê³ ê¸‰] ë©´ì ‘ ë‹¨ê³¨: for+var+ë¹„ë™ê¸°(ğŸ”¥)');

   /**
    * ì™œ varëŠ” 3,3,3ì´ ì°íˆë‚˜?
    * - varëŠ” ë¸”ë¡ ìŠ¤ì½”í”„ê°€ ì—†ê³ (í•¨ìˆ˜ ìŠ¤ì½”í”„), ë£¨í”„ê°€ ëë‚œ ë’¤ këŠ” 3ì´ ë¨
    * - setTimeout ì½œë°±ì€ "ë‚˜ì¤‘ì—" ì‹¤í–‰ë˜ë¯€ë¡œ, ì‹¤í–‰ ì‹œì ì—ëŠ” kê°€ ì´ë¯¸ 3
    */

   for (var k = 0; k < 3; k++) {
      setTimeout(() => console.log('var:', k), 0);
   }

   /**
    * ì •ë‹µ 1) let: ë£¨í”„ë§ˆë‹¤ ìƒˆë¡œìš´ ë¸”ë¡ ìŠ¤ì½”í”„ kê°€ ìƒê¹€(ê°ê° ìº¡ì²˜ë¨) â­
    */
   for (let k2 = 0; k2 < 3; k2++) {
      setTimeout(() => console.log('let:', k2), 0);
   }

   /**
    * ì •ë‹µ 2) IIFE: ì˜›ë‚  í•´ê²°ë²•(ë£¨í”„ ê°’ ìº¡ì²˜) â­
    */
   for (var k3 = 0; k3 < 3; k3++) {
      (function (captured) {
         setTimeout(() => console.log('iife:', captured), 0);
      })(k3);
   }
}

// =====================================================================
// 4) [ì‹¤ë¬´íŒ¨í„´] â­ ìƒíƒœ ì€ë‹‰(Store) / once / debounce / memoize
// =====================================================================
{
   section('4. [ì‹¤ë¬´íŒ¨í„´] í´ë¡œì € í™œìš© 4ì¢… ì„¸íŠ¸(â­)');

   // ----------------------------------------------------------
   // íŒ¨í„´ 1) Private Store (ìƒíƒœ ì€ë‹‰) â­
   // ----------------------------------------------------------
   function createStore(initial = 0) {
      let state = initial;

      return {
         getState() {
            return state;
         },
         setState(next) {
            // ğŸ›¡ï¸ ë°©ì–´: í•¨ìˆ˜í˜• ì—…ë°ì´íŠ¸ë„ í—ˆìš©(React setState ëŠë‚Œ)
            state = typeof next === 'function' ? next(state) : next;
         },
      };
   }

   const store = createStore(10);
   console.log('store.getState():', store.getState());
   store.setState((prev) => prev + 5);
   console.log('after update:', store.getState());

   // ----------------------------------------------------------
   // íŒ¨í„´ 2) once: í•œ ë²ˆë§Œ ì‹¤í–‰ë˜ê²Œ ë§Œë“¤ê¸° â­
   // ----------------------------------------------------------
   function once(fn) {
      let done = false;
      let cached;

      return function (...args) {
         if (done) return cached;
         done = true;
         cached = fn(...args);
         return cached;
      };
   }

   const init = once(() => {
      console.log('init ì‹¤í–‰(ë”± 1ë²ˆ)');
      return { ready: true };
   });

   console.log('init#1:', init());
   console.log('init#2:', init());

   // ----------------------------------------------------------
   // íŒ¨í„´ 3) debounce: ì—°ì† í˜¸ì¶œì„ "ë§ˆì§€ë§‰ 1ë²ˆ"ë§Œ ì‹¤í–‰ â­
   // ----------------------------------------------------------
   function debounce(fn, delayMs) {
      let timerId = null;

      return function (...args) {
         if (timerId) clearTimeout(timerId);
         timerId = setTimeout(() => fn(...args), delayMs);
      };
   }

   const onSearch = debounce((q) => console.log('ê²€ìƒ‰ ì‹¤í–‰:', q), 200);
   onSearch('a');
   onSearch('ab');
   onSearch('abc'); // ë§ˆì§€ë§‰ë§Œ ì‹¤í–‰ë  í™•ë¥ ì´ ë†’ìŒ

   // ----------------------------------------------------------
   // íŒ¨í„´ 4) memoize: ê°™ì€ ì…ë ¥ì´ë©´ ìºì‹œ ì‚¬ìš©(ì„±ëŠ¥) ğŸ”¥
   // ----------------------------------------------------------
   function memoize(fn) {
      const cache = new Map();

      return function (key) {
         if (cache.has(key)) {
            console.log('(cache hit)');
            return cache.get(key);
         }
         const result = fn(key);
         cache.set(key, result);
         return result;
      };
   }

   const heavy = (n) => {
      // ë¬´ê±°ìš´ ì—°ì‚° í‰ë‚´
      let sum = 0;
      for (let i = 0; i < n * 100000; i++) sum += i;
      return sum;
   };

   const memoHeavy = memoize(heavy);
   console.log('heavy#1:', memoHeavy(30));
   console.log('heavy#2:', memoHeavy(30)); // cache
}

// =====================================================================
// 5) [ì‹¤ë¬´ ì£¼ì˜] ğŸ›¡ï¸ í´ë¡œì €ì™€ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜: í° ê±¸ ìº¡ì²˜í•˜ì§€ ë§ì
// =====================================================================
{
   section('5. [ì‹¤ë¬´ ì£¼ì˜] í° ê°ì²´ ìº¡ì²˜ = ëˆ„ìˆ˜ ìœ„í—˜(ğŸ›¡ï¸)');

   /**
    * ì™œ ëˆ„ìˆ˜ê°€ ìƒê¸°ë‚˜?
    * - í´ë¡œì €ê°€ ì°¸ì¡°í•˜ëŠ” ê°’ì€ GCê°€ ì‰½ê²Œ ëª» ì¹˜ìš´ë‹¤.
    * - í° ë°ì´í„°(ë°°ì—´/DOM/ìºì‹œ)ë¥¼ ë¬´ì‹¬ì½” ìº¡ì²˜í•˜ë©´ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ëŠ˜ ìˆ˜ ìˆë‹¤.
    *
    * ì›ì¹™:
    * - "ì§„ì§œ í•„ìš”í•œ ìµœì†Œ"ë§Œ ìº¡ì²˜
    * - í•„ìš” ì—†ì–´ì§€ë©´ ì°¸ì¡°ë¥¼ ëŠê¸°(null ì²˜ë¦¬)
    */

   function createBigCapture() {
      const big = new Array(10000).fill('x');

      return function useSmallPart() {
         // ì‹¤ë¬´ì—ì„œëŠ” big ì „ì²´ê°€ ì•„ë‹ˆë¼ í•„ìš”í•œ ê°’ë§Œ ì €ì¥í•˜ëŠ” ê²Œ ì¢‹ë‹¤.
         return big.length;
      };
   }

   const fn = createBigCapture();
   console.log('big length:', fn());
}

// =====================================================================
// 6) [í•µì‹¬ì •ë¦¬] ë³µìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸ 12ê°œ âœ…
// =====================================================================
{
   section('6. [í•µì‹¬ì •ë¦¬] ë³µìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸ 12ê°œ âœ…');

   const checklist = [
      'í´ë¡œì € = í•¨ìˆ˜ + ê·¸ í•¨ìˆ˜ê°€ ì„ ì–¸ëœ ë ‰ì‹œì»¬ í™˜ê²½ì˜ ì¡°í•©ì´ë‹¤. ğŸ”¥',
      'í´ë¡œì €ëŠ” "ë³€ìˆ˜ ë³µì‚¬"ê°€ ì•„ë‹ˆë¼ "ì°¸ì¡° ìœ ì§€"ê°€ í•µì‹¬ì´ë‹¤. ğŸ”¥',
      'ë°”ê¹¥ í•¨ìˆ˜ê°€ ëë‚˜ë„, ì•ˆìª½ í•¨ìˆ˜ê°€ ì°¸ì¡°í•˜ë©´ ë°”ê¹¥ ë³€ìˆ˜ëŠ” ìœ ì§€ëœë‹¤. â­',
      'createCounterì²˜ëŸ¼ í´ë¡œì €ë¡œ ìƒíƒœë¥¼ ê¸°ì–µí•  ìˆ˜ ìˆë‹¤(ìƒíƒœ ì€ë‹‰). â­',
      'ì„œë¡œ ë‹¤ë¥¸ í˜¸ì¶œë¡œ ë§Œë“  í´ë¡œì €ëŠ” ì„œë¡œ ë‹¤ë¥¸ ìƒíƒœë¥¼ ê°€ì§„ë‹¤. â­',
      'ë©´ì ‘ ë‹¨ê³¨: for+var+ë¹„ë™ê¸°ëŠ” ë§ˆì§€ë§‰ ê°’ì´ ì°íˆê¸° ì‰½ë‹¤. ğŸ”¥',
      'í•´ê²°: let(ë¸”ë¡ ìŠ¤ì½”í”„) ë˜ëŠ” IIFEë¡œ ê°’ ìº¡ì²˜. ğŸ›¡ï¸',
      'í´ë¡œì €ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬/React hooks/ë¹„ë™ê¸° ì½œë°±ì— ìì—°ìŠ¤ëŸ½ê²Œ ë°œìƒí•œë‹¤. â­',
      'once/debounce/memoizeëŠ” ëŒ€í‘œì ì¸ í´ë¡œì € ìœ í‹¸ íŒ¨í„´ì´ë‹¤. â­',
      'memoizeëŠ” ìºì‹œë¥¼ Mapìœ¼ë¡œ ë“¤ê³  ìˆì–´ ê°™ì€ ì…ë ¥ì´ë©´ ë¹ ë¥´ë‹¤. ğŸ”¥',
      'í° ê°ì²´ë¥¼ ìº¡ì²˜í•˜ë©´ ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ìœ„í—˜ì´ ìƒê¸¸ ìˆ˜ ìˆë‹¤. ğŸ›¡ï¸',
      'ì›ì¹™: í•„ìš”í•œ ìµœì†Œë§Œ ìº¡ì²˜í•˜ê³ , í•„ìš” ì—†ì–´ì§€ë©´ ì°¸ì¡°ë¥¼ ëŠì–´ë¼. ğŸ›¡ï¸',
   ];

   checklist.forEach((item, idx) => {
      console.log(`${String(idx + 1).padStart(2, '0')}. ${item}`);
   });
}

console.log(`\n${line()}`);
console.log('Closure ìµœì¢… í…œí”Œë¦¿ ë! âœ…');
console.log(line());
