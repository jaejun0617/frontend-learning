/**
 * =====================================================================
 * í•¨ìˆ˜ë¡œ ê°ì²´ ë§Œë“¤ê¸°(ìƒì„±ì í•¨ìˆ˜) - í•™ìŠµ + ì‹¤ë¬´ í…œí”Œë¦¿ (2026)
 * =====================================================================
 * â­ = ì‹¤ë¬´ì—ì„œ ìì£¼ ì”€ / ğŸ”¥ = ì¤‘ìš”Â·ì‹¬í™” / ğŸ›¡ï¸ = ë°©ì–´ì  ì½”ë”©(Safety)
 *
 * [ë§¨ ìœ„ ê²°ë¡ : "ì§„ì§œ ì¤‘ìš”" vs "ê°œë…ë§Œ" âœ…]
 * âœ… ì§„ì§œ ì¤‘ìš”(2026ì—ë„ ê³„ì† ì”€) â­ğŸ”¥
 * - `this` ë°”ì¸ë”© ê·œì¹™ + `new`ì˜ ì˜ë¯¸(ì¸ìŠ¤í„´ìŠ¤ ìƒì„±/ì´ˆê¸°í™”)
 * - prototypeì— ë©”ì„œë“œë¥¼ ë¶™ì—¬ "ê³µìœ "í•˜ëŠ” ì›ë¦¬(ë©”ëª¨ë¦¬/ì„±ëŠ¥)
 * - `class`ë„ ê²°êµ­ prototype ê¸°ë°˜ì´ë¼ëŠ” í° ê·¸ë¦¼
 *
 * â˜‘ï¸ ê°œë…ë§Œ ì´í•´í•˜ë©´ ì¶©ë¶„(ì‹ ê·œ ì‹¤ë¬´ ì‚¬ìš© ë¹ˆë„ëŠ” ë‚®ìŒ)
 * - ìƒì„±ì í•¨ìˆ˜ íŒ¨í„´ ìì²´(function Foo(){})ëŠ” ë ˆê±°ì‹œê°€ ë§ì•„ "ì½ê³  ê³ ì¹˜ëŠ”" ìš©ë„
 * - new.target ê°™ì€ ë°©ì–´ íŒ¨í„´ì€ ë„ì›€ì´ ë˜ì§€ë§Œ, ì‹ ê·œ ì½”ë“œëŠ” classê°€ ë” í”í•¨
 * - arrow functionì€ ìƒì„±ì ë¶ˆê°€(new ë¶ˆê°€) â†’ ì—ëŸ¬ê°€ ì •ìƒ(ì´ìœ ë§Œ ì´í•´) ğŸ”¥
 *
 * [í•µì‹¬ì •ë¦¬(ë¨¼ì € ì½ê¸°) ğŸ”¥]
 * 1) ìƒì„±ì í•¨ìˆ˜ëŠ” `new`ì™€ í•¨ê»˜ í˜¸ì¶œë  ë•Œ "ì¸ìŠ¤í„´ìŠ¤(this)"ë¥¼ ë§Œë“ ë‹¤.
 * 2) ì¸ìŠ¤í„´ìŠ¤ë§ˆë‹¤ ë©”ì„œë“œë¥¼ ë§Œë“¤ë©´ ë‚­ë¹„ â†’ prototypeì— ë¶™ì—¬ ê³µìœ í•˜ëŠ” ê²Œ ì •ì„ â­
 * 3) `new`ë¥¼ ë¹¼ë¨¹ëŠ” ì‹¤ìˆ˜ë¥¼ ë§‰ê¸° ìœ„í•´ new.target ë°©ì–´ë¥¼ ë‘˜ ìˆ˜ ìˆë‹¤. ğŸ›¡ï¸
 * 4) Arrow Functionì€ constructorê°€ ì•„ë‹ˆë¼ì„œ `new`ë¡œ í˜¸ì¶œí•  ìˆ˜ ì—†ë‹¤. ğŸ”¥
 */

console.clear?.();

// ---------------------------------------------------------------------
// [Utility] ì¶œë ¥ í¬ë§·íŒ…
// ---------------------------------------------------------------------
const line = (n = 78) => '='.repeat(n);
const section = (title) => {
   console.log(`\n${line()}`);
   console.log(`â–¶ ${title}`);
   console.log(line());
};

// =====================================================================
// 1) [ì´ˆê¸‰] ìƒì„±ì í•¨ìˆ˜ ê¸°ë³¸: function + new
// =====================================================================
{
   section('1. [ì´ˆê¸‰] ìƒì„±ì í•¨ìˆ˜ ê¸°ë³¸ (function + new)');

   function IdolModel(name, year) {
      // ì´ í•¨ìˆ˜ëŠ” "newë¡œ ë¶ˆë¦¬ë©´" thisê°€ ìƒˆ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°€ë¦¬í‚¨ë‹¤.
      this.name = name;
      this.year = year;
   }

   const jaeJun = new IdolModel('ì‹ ì¬ì¤€', 1996);
   console.log('ì¸ìŠ¤í„´ìŠ¤:', jaeJun);
}

// =====================================================================
// 2) [ì¤‘ê¸‰] â­ prototype ë©”ì„œë“œ ê³µìœ : ì‹¤ë¬´/ì„±ëŠ¥ í•µì‹¬
// =====================================================================
{
   section('2. [ì¤‘ê¸‰] prototype ë©”ì„œë“œ ê³µìœ  (â­ ì‹¤ë¬´ í•µì‹¬)');

   function IdolModel(name, year) {
      this.name = name;
      this.year = year;

      // âš ï¸ (ë‚˜ìœ ì˜ˆ) ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œë¡œ ë§Œë“¤ë©´ ê°ì²´ë§ˆë‹¤ í•¨ìˆ˜ê°€ ìƒˆë¡œ ìƒê¹€
      // this.dance = function () { ... }
   }

   // â­ ì •ì„: prototypeì— ë©”ì„œë“œë¥¼ ë¶™ì´ë©´ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ê°€ "ê°™ì€ í•¨ìˆ˜"ë¥¼ ê³µìœ 
   // ì™œ? í•¨ìˆ˜ëŠ” 1ê°œë§Œ ë§Œë“¤ê³ , í˜¸ì¶œ ì‹œ thisë§Œ ë‹¬ë¼ì§€ë©´ ë˜ê¸° ë•Œë¬¸
   IdolModel.prototype.dance = function () {
      return `${this.name}ì´(ê°€) ì¶¤ì„ ì¶¥ë‹ˆë‹¤ ğŸ’ƒ`;
   };

   const a = new IdolModel('ì•ˆìœ ì§„', 2003);
   const b = new IdolModel('ì¥ì›ì˜', 2004);

   console.log(a.dance());
   console.log(b.dance());
   console.log('í•¨ìˆ˜ ê³µìœ  ì—¬ë¶€:', a.dance === b.dance); // true âœ…
}

// =====================================================================
// 3) [ê³ ê¸‰] ğŸ›¡ï¸ new.target ë°©ì–´: new ë¹ ëœ¨ë¦¼ ë°©ì§€
// =====================================================================
{
   section('3. [ê³ ê¸‰] new.target ë°©ì–´ (ğŸ›¡ï¸ ì‹¤ìˆ˜ ë°©ì§€)');

   function IdolModel(name, year) {
      // ğŸ›¡ï¸ ì™œ ë°©ì–´í•˜ë‚˜?
      // - `IdolModel('x', 1)`ì²˜ëŸ¼ newë¥¼ ë¹¼ë¨¹ìœ¼ë©´ thisê°€ ì˜ë„ëŒ€ë¡œ ì•ˆ ì¡í˜€ ë²„ê·¸ê°€ ëœë‹¤.
      // - strict modeì—ì„œëŠ” thisê°€ undefinedê°€ ë˜ì–´ ë°”ë¡œ í„°ì§€ê³ ,
      // - ëŠìŠ¨í•œ í™˜ê²½ì—ì„œëŠ” ì „ì—­ ê°ì²´ë¥¼ ì˜¤ì—¼ì‹œí‚¬ ìˆ˜ë„ ìˆë‹¤.
      if (!new.target) {
         return new IdolModel(name, year);
      }

      this.name = name;
      this.year = year;
   }

   IdolModel.prototype.introduce = function () {
      return `ì•ˆë…•í•˜ì„¸ìš”, ${this.name}ì…ë‹ˆë‹¤.`;
   };

   const x = new IdolModel('ë ˆì´', 2004);
   console.log('new í˜¸ì¶œ:', x.introduce());

   // new ì—†ì´ í˜¸ì¶œí•´ë„ ì•ˆì „í•˜ê²Œ newë¡œ ì¬í˜¸ì¶œ
   const y = IdolModel('ë¦¬ì¦ˆ', 2004);
   console.log('no-new í˜¸ì¶œ(ìë™ ë³´ì •):', y.introduce());
}

// =====================================================================
// 4) [ì‹¤ë¬´íŒ¨í„´] â­ ì‹ ê·œ ì½”ë“œëŠ” class ê¶Œì¥ + ë ˆê±°ì‹œ ì½ê¸° ì „ëµ
// =====================================================================
{
   section('4. [ì‹¤ë¬´íŒ¨í„´] class ê¶Œì¥ + ë ˆê±°ì‹œ ì½ê¸° ì „ëµ â­');

   /**
    * ê²°ë¡ ì ìœ¼ë¡œ ì‹ ê·œ ì‹¤ë¬´ëŠ” classë¥¼ ë” ë§ì´ ì“´ë‹¤.
    * - new ê°•ì œ, ë©”ì„œë“œ ê³µìœ (í”„ë¡œí† íƒ€ì…) ê¸°ë³¸ ì œê³µ
    * - private(#), static factory ë“± í˜„ëŒ€ íŒ¨í„´ì„ ì“°ê¸° ì‰¬ì›€
    */

   class IdolEntity {
      #name;
      #year;

      constructor(name, year) {
         this.#name = name;
         this.#year = year;
      }

      introduce() {
         return `[Class] ${this.#year}ë…„ìƒ ${this.#name}ì…ë‹ˆë‹¤.`;
      }

      // â­ ë ˆê±°ì‹œ ë°ì´í„°ë„ í‘œì¤€í™” ê°€ëŠ¥
      static fromLegacy(obj) {
         return new IdolEntity(obj?.name ?? 'unknown', obj?.year ?? 0);
      }
   }

   const legacyLike = { name: 'ê°€ì„', year: 2002 };
   const modern = IdolEntity.fromLegacy(legacyLike);
   console.log(modern.introduce());
}

// =====================================================================
// 4.5) [ì‹¬í™”] ğŸ”¥ Arrow Functionì€ new ë¶ˆê°€(ì—ëŸ¬ê°€ ì •ìƒ)
// =====================================================================
{
   section('4.5 [ì‹¬í™”] Arrow Functionì€ ìƒì„±ì ë¶ˆê°€ ğŸ”¥');

   // Arrow Functionì€ constructorê°€ ì•„ë‹ˆì–´ì„œ newë¡œ í˜¸ì¶œí•  ìˆ˜ ì—†ë‹¤.
   // ì™œ? arrowëŠ” ìì²´ this/arguments/prototypeì„ ê°–ì§€ ì•Šê¸° ë•Œë¬¸(ë¬¸ë²• ì„¤ê³„).
   const IdolModelArrow = (name, year) => {
      // ì—¬ê¸°ì„œ thisëŠ” "ì •ì˜ëœ ìŠ¤ì½”í”„"ì— ë¬¶ì¸ë‹¤.
      // ê·¸ë˜ì„œ ìƒì„±ìì²˜ëŸ¼ "ìƒˆ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì„¸íŒ…"í•˜ëŠ” íŒ¨í„´ì— ë¶€ì í•©.
      return { name, year };
   };

   // ì‹¤í–‰ì€ ì•ˆì „í•˜ê²Œ try/catchë¡œ ë³´ì—¬ì£¼ê¸°
   try {
      // eslint-disable-next-line no-new
      const bad = new IdolModelArrow('ì‹ ì¬ì¤€', 1996);
      console.log(bad);
   } catch (e) {
      console.log('âœ… ì •ìƒ ë™ì‘: arrowëŠ” new ë¶ˆê°€ â†’', e?.message);
   }

   // ëŒ€ì‹  arrowëŠ” "íŒ©í† ë¦¬ í•¨ìˆ˜"ë¡œëŠ” ë§¤ìš° ì í•©
   const ok = IdolModelArrow('ì‹ ì¬ì¤€', 1996);
   console.log('íŒ©í† ë¦¬ë¡œ ì‚¬ìš©:', ok);
}

// =====================================================================
// 5) [í•µì‹¬ì •ë¦¬] ë³µìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸ 12ê°œ âœ…
// =====================================================================
{
   section('5. [í•µì‹¬ì •ë¦¬] ë³µìŠµ ì²´í¬ë¦¬ìŠ¤íŠ¸ 12ê°œ âœ…');

   const checklist = [
      'ìƒì„±ì í•¨ìˆ˜ëŠ” `new`ì™€ í•¨ê»˜ í˜¸ì¶œë  ë•Œ ì¸ìŠ¤í„´ìŠ¤(this)ë¥¼ ë§Œë“ ë‹¤. ğŸ”¥',
      'newëŠ” ëŒ€ëµ: ê°ì²´ ìƒì„± â†’ prototype ì—°ê²° â†’ this ë°”ì¸ë”© â†’ í•¨ìˆ˜ ì‹¤í–‰ â†’ ê°ì²´ ë°˜í™˜',
      'ì¸ìŠ¤í„´ìŠ¤ë§ˆë‹¤ ë©”ì„œë“œë¥¼ ë§Œë“¤ë©´ í•¨ìˆ˜ê°€ ì¤‘ë³µ ìƒì„±ëœë‹¤(ë©”ëª¨ë¦¬ ë‚­ë¹„). ğŸ”¥',
      'prototypeì— ë©”ì„œë“œë¥¼ ë‘ë©´ ì¸ìŠ¤í„´ìŠ¤ë“¤ì´ í•¨ìˆ˜ë¥¼ ê³µìœ í•œë‹¤. â­',
      'ê³µìœ  ë©”ì„œë“œëŠ” thisë§Œ ë°”ë€Œê³  í•¨ìˆ˜ ë³¸ì²´ëŠ” ë™ì¼í•˜ë‹¤(íš¨ìœ¨ì ). â­',
      'newë¥¼ ë¹¼ë¨¹ìœ¼ë©´ thisê°€ ì˜ë„ëŒ€ë¡œ ì¡íˆì§€ ì•Šì•„ ë²„ê·¸ê°€ ë‚œë‹¤. ğŸ›¡ï¸',
      'new.target ë°©ì–´ë¡œ new ì—†ì´ í˜¸ì¶œí•´ë„ ì•ˆì „í•˜ê²Œ ë³´ì •í•  ìˆ˜ ìˆë‹¤. ğŸ›¡ï¸',
      'ì‹ ê·œ ì‹¤ë¬´ ì½”ë“œëŠ” ë³´í†µ classë¥¼ ì„ í˜¸í•œë‹¤(ê°€ë…ì„±/ì•ˆì „ì„±). â­',
      'classë„ ë‚´ë¶€ì ìœ¼ë¡œëŠ” prototype ê¸°ë°˜ì´ë‹¤(ì›ë¦¬ ë™ì¼). ğŸ”¥',
      'Arrow Functionì€ constructorê°€ ì•„ë‹ˆë¼ì„œ newë¡œ í˜¸ì¶œí•  ìˆ˜ ì—†ë‹¤. ğŸ”¥',
      'ArrowëŠ” thisê°€ ë°”ê¹¥ ìŠ¤ì½”í”„ì— ê³ ì •ë˜ì–´ ìƒì„±ì íŒ¨í„´ì— ë¶€ì í•©í•˜ë‹¤. ğŸ”¥',
      'ê²°ë¡ : ë ˆê±°ì‹œëŠ” ì½ê¸°/ìˆ˜ì •ìš©ìœ¼ë¡œ ì´í•´, ì‹ ê·œëŠ” classë¡œ ì‘ì„±í•˜ë©´ ëœë‹¤. âœ…',
   ];

   checklist.forEach((item, idx) => {
      console.log(`${String(idx + 1).padStart(2, '0')}. ${item}`);
   });
}

console.log(`\n${line()}`);
console.log('Constructor Function ìµœì¢… í…œí”Œë¦¿ ë! âœ…');
console.log(line());
