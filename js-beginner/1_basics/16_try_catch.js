/**
 * ==========================================
 * JavaScript ì—ëŸ¬ í•¸ë“¤ë§ (Error Handling) ì™„ë²½ ì •ë¦¬
 * ==========================================
 *
 * â­ = ì‹¤ë¬´ í•„ìˆ˜ íŒ¨í„´
 * ğŸ”¥ = ë¹„ë™ê¸° í†µì‹ (API)ì—ì„œ ë¬´ì¡°ê±´ ì‚¬ìš©
 *
 * [í•µì‹¬ ê°œë…]
 * 1. try: ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì½”ë“œë¥¼ ì‹¤í–‰
 * 2. catch: ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ì¡ì•„ë‚´ëŠ” ê³³ (ë³µêµ¬/ë¡œê¹…)
 * 3. finally: ì„±ê³µí•˜ë“  ì‹¤íŒ¨í•˜ë“  ë¬´ì¡°ê±´ ì‹¤í–‰ (ì²­ì†Œ/ë¡œë”©í•´ì œ)
 * 4. throw: ì—ëŸ¬ë¥¼ ê°•ì œë¡œ ë°œìƒì‹œí‚´ (ë˜ì§€ê¸°)
 */

// ==========================================
// 1. ê¸°ë³¸ ë¬¸ë²• (Basic Syntax)
// ==========================================
console.log('=== 1. ê¸°ë³¸ ë¬¸ë²• ===');

function runner() {
   console.log('--- ì‹¤í–‰ ì‹œì‘ ---');

   try {
      console.log('1. ì •ìƒ ì½”ë“œ ì‹¤í–‰');

      // ğŸ”¥ ì—ëŸ¬ ê°•ì œ ë°œìƒ (throw)
      // Error ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ë˜ì§€ëŠ” ê²ƒì´ ê´€ë¡€ì…ë‹ˆë‹¤.
      throw new Error('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤!');
   } catch (e) {
      console.log('--- catch (ì—ëŸ¬ ì¡ìŒ) ---');

      // eëŠ” Error ê°ì²´ì…ë‹ˆë‹¤.
      console.log('ì—ëŸ¬ ë‚´ìš©:', e);
   } finally {
      console.log('--- finally (ë¬´ì¡°ê±´ ì‹¤í–‰) ---');
      // ìš©ë„: ë¡œë”© ìŠ¤í”¼ë„ˆ ì¢…ë£Œ, DB ì—°ê²° í•´ì œ ë“±
      console.log('3. ì‘ì—… ë§ˆë¬´ë¦¬ ë° ë¦¬ì†ŒìŠ¤ í•´ì œ');
   }
}

runner();

console.log('='.repeat(40));

// ==========================================
// 2. Error ê°ì²´ì˜ í•µì‹¬ ì†ì„± â­â­
// ==========================================
console.log('\n=== 2. Error ê°ì²´ ëœ¯ì–´ë³´ê¸° ===');

try {
   // ì—†ëŠ” í•¨ìˆ˜ í˜¸ì¶œ (ReferenceError ë°œìƒ)
   nonExistentFunction();
} catch (e) {
   console.log('1. ì—ëŸ¬ ì´ë¦„ (name):', e.name); // ì˜ˆ: ReferenceError
   console.log('2. ì—ëŸ¬ ë©”ì‹œì§€ (message):', e.message); // ì˜ˆ: nonExistentFunction is not defined

   // ğŸ”¥ ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ (Stack Trace) - ë””ë²„ê¹…ì˜ í•µì‹¬
   // ì—ëŸ¬ê°€ ì–´ë””ì„œ ë°œìƒí–ˆëŠ”ì§€ íŒŒì¼ ìœ„ì¹˜ì™€ ì¤„ ë²ˆí˜¸ë¥¼ ì•Œë ¤ì¤Œ
   console.log('3. ìŠ¤íƒ íŠ¸ë ˆì´ìŠ¤ (stack):', e.stack);
}

console.log('='.repeat(40));

// ==========================================
// 3. ì‹¤ë¬´í˜• íŒ¨í„´: ë¹„ë™ê¸° ì—ëŸ¬ í•¸ë“¤ë§ (Async/Await) ğŸ”¥ğŸ”¥ğŸ”¥
// ==========================================
console.log('\n=== 3. [ì‹¤ë¬´] ë¹„ë™ê¸° ì—ëŸ¬ í•¸ë“¤ë§ ===');

/**
 * ì‹¤ë¬´ì—ì„œëŠ” API í†µì‹ í•  ë•Œ ê°€ì¥ ë§ì´ ì”ë‹ˆë‹¤.
 * try-catchê°€ ì—†ìœ¼ë©´ ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ì‹œ ì•±ì´ ë©ˆì¶°ë²„ë¦½ë‹ˆë‹¤.
 */

const fetchUserData = async () => {
   try {
      console.log('â³ ì„œë²„ ë°ì´í„° ìš”ì²­ ì¤‘...');

      // 1ì´ˆ ë’¤ì— ì—ëŸ¬ê°€ ë‚˜ëŠ” ìƒí™© ì‹œë®¬ë ˆì´ì…˜
      await new Promise((resolve, reject) => {
         setTimeout(() => {
            reject(new Error('404 Not Found (ì„œë²„ ì—ëŸ¬)'));
         }, 1000);
      });

      console.log('âœ… ë°ì´í„° ìˆ˜ì‹  ì™„ë£Œ'); // ì‹¤í–‰ ì•ˆë¨
   } catch (e) {
      console.log(`ğŸš¨ ì—ëŸ¬ ë°œìƒ: ${e.message}`);

      // ì‹¤ë¬´ íŒ: ì—¬ê¸°ì„œ 'ì—ëŸ¬ í˜ì´ì§€'ë¡œ ì´ë™ì‹œí‚¤ê±°ë‚˜ 'í† ìŠ¤íŠ¸ ë©”ì‹œì§€'ë¥¼ ë„ì›€
      // alert('ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
   } finally {
      console.log('ğŸ§¹ ë¡œë”© ìŠ¤í”¼ë„ˆ ë„ê¸° (isLoading = false)');
   }
};

// fetchUserData(); // (ë¹„ë™ê¸°ë¼ ë¡œê·¸ê°€ ì„ì¼ ìˆ˜ ìˆì–´ ì£¼ì„ ì²˜ë¦¬í•¨)

console.log('='.repeat(40));

// ==========================================
// 4. ì—ëŸ¬ ë‹¤ì‹œ ë˜ì§€ê¸° (Re-throwing) â­ ê³ ê¸‰
// ==========================================
console.log('\n=== 4. ì—ëŸ¬ ë‹¤ì‹œ ë˜ì§€ê¸° (Re-throwing) ===');

/**
 * catchì—ì„œ í•´ê²°í•  ìˆ˜ ì—†ëŠ” ì—ëŸ¬ë¼ë©´?
 * ë¡œê·¸ë§Œ ë‚¨ê¸°ê³  ë‹¤ì‹œ ë˜ì ¸ì„œ ìƒìœ„ í•¨ìˆ˜ê°€ ì²˜ë¦¬í•˜ê²Œ ë§Œë“¦.
 */

function dangerousWork() {
   try {
      throw new Error('ì¹˜ëª…ì ì¸ ì—ëŸ¬');
   } catch (e) {
      console.log('âš ï¸ ë‚´ë¶€ì—ì„œ 1ì°¨ ê¸°ë¡ ë‚¨ê¹€');
      // ì—¬ê¸°ì„œ í•´ê²° ëª»í•˜ê² ìŒ, ë°–ìœ¼ë¡œ ë˜ì§
      throw e;
   }
}

try {
   dangerousWork();
} catch (e) {
   console.log('ğŸš¨ ë©”ì¸ ì‹œìŠ¤í…œì—ì„œ ìµœì¢… í¬ì°©:', e.message);
}

console.log('='.repeat(40));

// ==========================================
// 5. ì»¤ìŠ¤í…€ ì—ëŸ¬ ë§Œë“¤ê¸° (Custom Error) â­ ê³ ê¸‰
// ==========================================
console.log('\n=== 5. ì»¤ìŠ¤í…€ ì—ëŸ¬ í´ë˜ìŠ¤ ===');

/**
 * ê·¸ëƒ¥ Error ë§ê³ , ìƒí™©ì— ë§ëŠ” êµ¬ì²´ì ì¸ ì—ëŸ¬ë¥¼ ë§Œë“¦
 */

class PasswordTooShortError extends Error {
   constructor(message) {
      super(message);
      this.name = 'PasswordTooShortError';
   }
}

function register(password) {
   if (password.length < 5) {
      throw new PasswordTooShortError('ë¹„ë°€ë²ˆí˜¸ëŠ” 5ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
   }
   return 'ê°€ì… ì„±ê³µ';
}

try {
   register('1234');
} catch (e) {
   if (e instanceof PasswordTooShortError) {
      console.log('âŒ ë¹„ë°€ë²ˆí˜¸ ì—ëŸ¬:', e.message);
   } else {
      console.log('âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì—ëŸ¬:', e.message);
   }
}

console.log('='.repeat(40));

/**
 * ==========================================
 * ğŸ”¥ í•µì‹¬ ìš”ì•½
 * ==========================================
 *
 * 1. ì—ëŸ¬ë¥¼ ë°œìƒì‹œí‚¬ ë• ë¬¸ìì—´ ë§ê³  `new Error('ë©”ì‹œì§€')` ê°ì²´ë¥¼ ë˜ì§€ì. (ìŠ¤íƒ ì¶”ì ì„ ìœ„í•´)
 * 2. API ìš”ì²­(`async/await`)ì´ë‚˜ JSON íŒŒì‹±(`JSON.parse`)ì€ ë°˜ë“œì‹œ try-catchë¡œ ê°ì‹¸ì•¼ í•œë‹¤.
 * 3. finallyëŠ” ì„±ê³µ/ì‹¤íŒ¨ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ ë¬´ì¡°ê±´ ì‹¤í–‰ëœë‹¤. (ë¡œë”© ì¢…ë£Œ ì²˜ë¦¬ì— í•„ìˆ˜)
 * 4. catch ë¸”ë¡ ì•ˆì„ ë¹„ì›Œë‘ì§€ ë§ˆë¼. ìµœì†Œí•œ `console.error(e)`ë¼ë„ ì°ì–´ì•¼ ë””ë²„ê¹…ì´ ê°€ëŠ¥í•˜ë‹¤.
 */
